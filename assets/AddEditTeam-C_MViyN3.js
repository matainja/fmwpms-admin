import{j as e,bo as z,bC as te,u as w,bD as ie,r as p,bm as ne,b5 as F,b6 as h,b7 as k,a8 as S,B as b,bE as q,aa as I}from"./index-CDkEqm6-.js";import{d as U,a as C}from"./defaultErrorMessage.constant-Bll1G2ZT.js";import{u as re,n as le,i as $}from"./useNavigation-DKeU22nA.js";import{u as ce}from"./useStaff-G4XpSq3-.js";import{u as de}from"./useTeam-B_lz015c.js";import{H as oe}from"./Header-qFXKe93H.js";import{F as O,c as me,a as R,b as T,e as H}from"./index.esm-Cs7TAVD3.js";import{l as fe}from"./lodash-CqPUagu2.js";import"./cloneDeep-DJN0yfLA.js";const ue=v=>e.jsx("div",{className:"flex flex-col gap-4",children:e.jsx("div",{className:"flex flex-auto items-center gap-2",children:e.jsxs("div",{className:"flex flex-col gap-4 w-full",children:[e.jsx(z,{height:10}),e.jsx(z,{height:10,width:"60%"})]})})}),L=me().shape({teamname:H().required("Team Name Required"),description:H().required("Team description Required").max(200,"Team description must be at most 200 characters")}),pe=[{value:"staff",label:"staff"},{value:"supervisor",label:"supervisor"},{value:"officer",label:"officer"}],W=({field:v,form:c,...f})=>e.jsx("div",{children:e.jsx(k,{...v,...f,className:`textarea ${c.errors[v.name]&&c.touched[v.name]?"error":""}`,rows:4,textArea:!0})}),A="staff",Te=v=>{const{type:c,id:f}=te(),{selectedYear:Y}=w(t=>t.year),j=w(t=>t.staffOption)||[],o=w(ie(f||"")),[d,x]=p.useState([{staff_id:"",role:A}]),[u,g]=p.useState([]),[y,G]=p.useState([{value:"",label:""}]),[N,_]=p.useState({teamname:"",description:""}),m=p.useRef(!0),{getTeam:P,assignStaffTeam:J,editTeam:K,addTeam:Q}=de(),{createStaffOption:X}=ce(),{Navigate:E}=re();if(p.useEffect(()=>{(async()=>{await X(),fe.isEmpty(o)&&await P()})(),G(pe)},[]),c==="add"&&j.length>0&&m.current&&(_({teamname:"",description:""}),g(j),m.current=!1),c==="edit"&&j.length>0&&o&&m.current&&(_({teamname:o.name||"",description:o.description||""}),m.current=!1),c==="assignUser"&&j.length>0&&o&&m.current){_({teamname:o.name||"",description:o.description||""});const t=j.map(i=>({...i}));o.members.forEach(async i=>{if(i.staff_id){const n=t.findIndex(a=>a.staff_id===i.staff_id);n!==-1&&(t[n].isDisabled=!0)}}),g(t);const s=o.members.map(({staff_id:i,position:n})=>({role:n,staff_id:i}));x(s),m.current=!1}p.useEffect(()=>{if(d.length>0){const t=d.length-1;d[t].staff_id!==""&&x(s=>[...s,{staff_id:"",role:A}])}else x([{staff_id:"",role:A}])},[d]);const Z=()=>{switch(c){case"add":return"Add Team";case"edit":return"Edit Team";case"assignUser":return`Assign staff to ${N.teamname}`;default:return""}},M=(t,s)=>{const i=d[s].staff_id;if(i!==""){const a=u.findIndex(r=>r.staff_id===i);a!==-1&&g(r=>{const l=[...r];return l[a]={...l[a],isDisabled:!1},l})}x(a=>{const r=[...a];return r[s]={...r[s],staff_id:t},r});const n=u.findIndex(a=>a.staff_id===t);n!==-1&&g(a=>{const r=[...a];return r[n]={...r[n],isDisabled:!0},r})},B=(t,s)=>{x(i=>{const n=[...i];return n[s]={...n[s],role:t},n})},V=t=>{const s=d[t].staff_id;if(s!==""){const i=u.findIndex(n=>n.staff_id===s);i!==-1&&g(n=>{const a=[...n];return a[i]={...a[i],isDisabled:!1},a})}x(i=>i.filter((n,a)=>a!==t))},ee=async t=>{const{teamname:s,description:i}=t,n={name:s,year:Y,description:i,staff_list:d.filter(r=>r.staff_id!==""&&r.role!=="")},a=await Q(n);(a==null?void 0:a.status)==="success"&&E(le),I((a==null?void 0:a.status)||C,(a==null?void 0:a.message)||U)},ae=async t=>{const{teamname:s,description:i}=t,n={id:String(f),name:s,description:i},a=await K(n);(a==null?void 0:a.status)==="success"&&E($,String(f)),I((a==null?void 0:a.status)||C,(a==null?void 0:a.message)||U)},se=async()=>{const t={id:String(f),staff_list:d.filter(i=>i.staff_id!==""&&i.role!=="")},s=await J(t);(s==null?void 0:s.status)==="success"&&E($,String(f)),I((s==null?void 0:s.status)||C,(s==null?void 0:s.message)||U)};return e.jsxs("div",{children:[e.jsx(oe,{title:Z(),showYear:!0}),m.current&&e.jsx(ue,{}),!m.current&&e.jsxs(ne,{children:[c==="add"&&e.jsx(O,{initialValues:N,validationSchema:L,enableReinitialize:!0,onSubmit:async(t,{setSubmitting:s})=>{await ee(t),setTimeout(()=>{s(!1)},400)},children:({values:t,errors:s,touched:i,isSubmitting:n})=>e.jsxs(R,{children:[e.jsxs(F,{className:"md:grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{layout:"vertical",label:"Team Name",invalid:s.teamname&&i.teamname,errorMessage:s.teamname,children:e.jsx(T,{type:"text",name:"teamname",placeholder:"Team Name",component:k,value:t.teamname})}),e.jsx(h,{label:"User add",children:d.map((a,r)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"grid md:grid-flow-col md:grid-cols-2 gap-2 mb-2 w-full",children:[e.jsx("div",{children:e.jsx(S,{className:"mb-4",placeholder:"Search ...",options:u,onChange:l=>{M(l.staff_id,r)},value:u.find(l=>l.staff_id===a.staff_id)||""})}),e.jsx("div",{children:e.jsx(S,{isDisabled:a.staff_id==="",className:"mb-4",placeholder:"Search ...",options:y,onChange:l=>{B(l.value,r)},value:y.find(l=>l.value===a.role)})})]}),e.jsx("div",{className:"w-12 flex justify-center items-center",children:e.jsx(b,{shape:"circle",size:"xs",icon:e.jsx(q,{className:"p-0 text-white"}),onClick:l=>V(r),style:{backgroundColor:"#FF5733",border:"none"},className:"ms-2 p-0",type:"button"})})]},r))})]}),e.jsx("div",{children:e.jsx(h,{layout:"vertical",label:"Team Description",invalid:s.description&&i.description,errorMessage:s.description,children:e.jsx(T,{type:"text",name:"description",placeholder:"Team Description",component:W,value:t.description})})})]}),e.jsx("div",{className:"flex justify-end gap-2",children:e.jsx(b,{type:"submit",variant:"solid",loading:n,children:"Save to DB"})})]})}),c==="edit"&&e.jsx(O,{initialValues:N,validationSchema:L,enableReinitialize:!0,onSubmit:async(t,{setSubmitting:s})=>{await ae(t),setTimeout(()=>{s(!1)},400)},children:({values:t,errors:s,touched:i,isSubmitting:n})=>e.jsxs(R,{children:[e.jsxs(F,{className:"md:grid grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx(h,{layout:"vertical",label:"Team Name",invalid:s.teamname&&i.teamname,errorMessage:s.teamname,children:e.jsx(T,{type:"text",name:"teamname",placeholder:"Team Name",component:k,value:t.teamname})})}),e.jsx("div",{children:e.jsx(h,{layout:"vertical",label:"Team Description",invalid:s.description&&i.description,errorMessage:s.description,children:e.jsx(T,{type:"text",name:"description",placeholder:"Team Description",component:W,value:t.description})})})]}),e.jsx("div",{className:"flex justify-end gap-2",children:e.jsx(b,{type:"submit",variant:"solid",loading:n,children:"Save to DB"})})]})}),c==="assignUser"&&e.jsx(O,{initialValues:N,enableReinitialize:!0,onSubmit:async(t,{setSubmitting:s})=>{await se(),setTimeout(()=>{s(!1)},400)},children:({values:t,errors:s,touched:i,isSubmitting:n})=>e.jsxs(R,{children:[e.jsx(F,{children:e.jsx("div",{children:e.jsx(h,{label:"User add",children:d.map((a,r)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"grid md:grid-flow-col md:grid-cols-2 gap-2 mb-2 w-full",children:[e.jsx("div",{children:e.jsx(S,{className:"mb-4",placeholder:"Search ...",options:u,onChange:l=>{M(l.staff_id,r)},value:u.find(l=>l.staff_id===a.staff_id)||""})}),e.jsx("div",{children:e.jsx(S,{isDisabled:a.staff_id==="",className:"mb-4",placeholder:"Search ...",options:y,onChange:l=>{B(l.value,r)},value:y.find(l=>l.value===a.role)})})]}),e.jsx("div",{className:"w-12 flex justify-center items-center",children:e.jsx(b,{shape:"circle",size:"xs",icon:e.jsx(q,{className:"p-0 text-white"}),onClick:l=>V(r),style:{backgroundColor:"#FF5733",border:"none"},className:"ms-2 p-0",type:"button"})})]},r))})})}),e.jsx("div",{className:"flex justify-end gap-2",children:e.jsx(b,{type:"submit",variant:"solid",loading:n,children:"Save to DB"})})]})})]})]})};export{Te as default};
