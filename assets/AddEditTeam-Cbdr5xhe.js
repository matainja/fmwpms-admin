import{j as e,bj as V,bA as se,u as z,bB as te,r as p,bh as ie,b0 as w,b1 as h,b2 as R,a8 as y,B as b,bC as q,aa as F}from"./index-qKyAsuGp.js";import{d as I,a as U}from"./defaultErrorMessage.constant-Bll1G2ZT.js";import{u as ne,n as re,i as $}from"./useNavigation-NC_OiJ1A.js";import{u as le}from"./useStaff-C5_dWkS1.js";import{u as ce}from"./useTeam-DDHkqABX.js";import{H as de}from"./Header-DvuXfC3n.js";import{F as C,c as oe,a as O,b as T,e as H}from"./index.esm-Cua1qn9k.js";import{l as me}from"./lodash-D8Rb5k7A.js";import"./cloneDeep-DJN0yfLA.js";const fe=v=>e.jsx("div",{className:"flex flex-col gap-4",children:e.jsx("div",{className:"flex flex-auto items-center gap-2",children:e.jsxs("div",{className:"flex flex-col gap-4 w-full",children:[e.jsx(V,{height:10}),e.jsx(V,{height:10,width:"60%"})]})})}),L=oe().shape({teamname:H().required("Team Name Required"),description:H().required("Team description Required").max(200,"Team description must be at most 200 characters")}),ue=[{value:"staff",label:"staff"},{value:"supervisor",label:"supervisor"},{value:"officer",label:"officer"}],W=({field:v,form:c,...f})=>e.jsx("div",{children:e.jsx(R,{...v,...f,className:`textarea ${c.errors[v.name]&&c.touched[v.name]?"error":""}`,rows:4,textArea:!0})}),A="staff",ye=v=>{const{type:c,id:f}=se(),j=z(t=>t.staffOption)||[],o=z(te(f||"")),[d,x]=p.useState([{staff_id:"",role:A}]),[u,g]=p.useState([]),[N,G]=p.useState([{value:"",label:""}]),[S,_]=p.useState({teamname:"",description:""}),m=p.useRef(!0),{getTeam:P,assignStaffTeam:Y,editTeam:J,addTeam:K}=ce(),{createStaffOption:Q}=le(),{Navigate:E}=ne();if(p.useEffect(()=>{(async()=>{await Q(),me.isEmpty(o)&&await P()})(),G(ue)},[]),c==="add"&&j.length>0&&m.current&&(_({teamname:"",description:""}),g(j),m.current=!1),c==="edit"&&j.length>0&&o&&m.current&&(_({teamname:o.name||"",description:o.description||""}),m.current=!1),c==="assignUser"&&j.length>0&&o&&m.current){_({teamname:o.name||"",description:o.description||""});const t=j.map(i=>({...i}));o.members.forEach(async i=>{if(i.staff_id){const n=t.findIndex(a=>a.staff_id===i.staff_id);n!==-1&&(t[n].isDisabled=!0)}}),g(t);const s=o.members.map(({staff_id:i,position:n})=>({role:n,staff_id:i}));x(s),m.current=!1}p.useEffect(()=>{if(d.length>0){const t=d.length-1;d[t].staff_id!==""&&x(s=>[...s,{staff_id:"",role:A}])}else x([{staff_id:"",role:A}])},[d]);const X=()=>{switch(c){case"add":return"Add Team";case"edit":return"Edit Team";case"assignUser":return`Assign staff to ${S.teamname}`;default:return""}},k=(t,s)=>{const i=d[s].staff_id;if(i!==""){const a=u.findIndex(r=>r.staff_id===i);a!==-1&&g(r=>{const l=[...r];return l[a]={...l[a],isDisabled:!1},l})}x(a=>{const r=[...a];return r[s]={...r[s],staff_id:t},r});const n=u.findIndex(a=>a.staff_id===t);n!==-1&&g(a=>{const r=[...a];return r[n]={...r[n],isDisabled:!0},r})},B=(t,s)=>{x(i=>{const n=[...i];return n[s]={...n[s],role:t},n})},M=t=>{const s=d[t].staff_id;if(s!==""){const i=u.findIndex(n=>n.staff_id===s);i!==-1&&g(n=>{const a=[...n];return a[i]={...a[i],isDisabled:!1},a})}x(i=>i.filter((n,a)=>a!==t))},Z=async t=>{const{teamname:s,description:i}=t,n={name:s,description:i,staff_list:d.filter(r=>r.staff_id!==""&&r.role!=="")},a=await K(n);(a==null?void 0:a.status)==="success"&&E(re),F((a==null?void 0:a.status)||U,(a==null?void 0:a.message)||I)},ee=async t=>{const{teamname:s,description:i}=t,n={id:String(f),name:s,description:i},a=await J(n);(a==null?void 0:a.status)==="success"&&E($,String(f)),F((a==null?void 0:a.status)||U,(a==null?void 0:a.message)||I)},ae=async()=>{const t={id:String(f),staff_list:d.filter(i=>i.staff_id!==""&&i.role!=="")},s=await Y(t);(s==null?void 0:s.status)==="success"&&E($,String(f)),F((s==null?void 0:s.status)||U,(s==null?void 0:s.message)||I)};return e.jsxs("div",{children:[e.jsx(de,{title:X(),showYear:!0}),m.current&&e.jsx(fe,{}),!m.current&&e.jsxs(ie,{children:[c==="add"&&e.jsx(C,{initialValues:S,validationSchema:L,enableReinitialize:!0,onSubmit:async(t,{setSubmitting:s})=>{await Z(t),setTimeout(()=>{s(!1)},400)},children:({values:t,errors:s,touched:i,isSubmitting:n})=>e.jsxs(O,{children:[e.jsxs(w,{className:"md:grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{layout:"vertical",label:"Team Name",invalid:s.teamname&&i.teamname,errorMessage:s.teamname,children:e.jsx(T,{type:"text",name:"teamname",placeholder:"Team Name",component:R,value:t.teamname})}),e.jsx(h,{label:"User add",children:d.map((a,r)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"grid md:grid-flow-col md:grid-cols-2 gap-2 mb-2 w-full",children:[e.jsx("div",{children:e.jsx(y,{className:"mb-4",placeholder:"Search ...",options:u,onChange:l=>{k(l.staff_id,r)},value:u.find(l=>l.staff_id===a.staff_id)||""})}),e.jsx("div",{children:e.jsx(y,{isDisabled:a.staff_id==="",className:"mb-4",placeholder:"Search ...",options:N,onChange:l=>{B(l.value,r)},value:N.find(l=>l.value===a.role)})})]}),e.jsx("div",{className:"w-12 flex justify-center items-center",children:e.jsx(b,{shape:"circle",size:"xs",icon:e.jsx(q,{className:"p-0 text-white"}),onClick:l=>M(r),style:{backgroundColor:"#FF5733",border:"none"},className:"ms-2 p-0",type:"button"})})]},r))})]}),e.jsx("div",{children:e.jsx(h,{layout:"vertical",label:"Team Description",invalid:s.description&&i.description,errorMessage:s.description,children:e.jsx(T,{type:"text",name:"description",placeholder:"Team Description",component:W,value:t.description})})})]}),e.jsx("div",{className:"flex justify-end gap-2",children:e.jsx(b,{type:"submit",variant:"solid",loading:n,children:"Save to DB"})})]})}),c==="edit"&&e.jsx(C,{initialValues:S,validationSchema:L,enableReinitialize:!0,onSubmit:async(t,{setSubmitting:s})=>{await ee(t),setTimeout(()=>{s(!1)},400)},children:({values:t,errors:s,touched:i,isSubmitting:n})=>e.jsxs(O,{children:[e.jsxs(w,{className:"md:grid grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx(h,{layout:"vertical",label:"Team Name",invalid:s.teamname&&i.teamname,errorMessage:s.teamname,children:e.jsx(T,{type:"text",name:"teamname",placeholder:"Team Name",component:R,value:t.teamname})})}),e.jsx("div",{children:e.jsx(h,{layout:"vertical",label:"Team Description",invalid:s.description&&i.description,errorMessage:s.description,children:e.jsx(T,{type:"text",name:"description",placeholder:"Team Description",component:W,value:t.description})})})]}),e.jsx("div",{className:"flex justify-end gap-2",children:e.jsx(b,{type:"submit",variant:"solid",loading:n,children:"Save to DB"})})]})}),c==="assignUser"&&e.jsx(C,{initialValues:S,enableReinitialize:!0,onSubmit:async(t,{setSubmitting:s})=>{await ae(),setTimeout(()=>{s(!1)},400)},children:({values:t,errors:s,touched:i,isSubmitting:n})=>e.jsxs(O,{children:[e.jsx(w,{children:e.jsx("div",{children:e.jsx(h,{label:"User add",children:d.map((a,r)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"grid md:grid-flow-col md:grid-cols-2 gap-2 mb-2 w-full",children:[e.jsx("div",{children:e.jsx(y,{className:"mb-4",placeholder:"Search ...",options:u,onChange:l=>{k(l.staff_id,r)},value:u.find(l=>l.staff_id===a.staff_id)||""})}),e.jsx("div",{children:e.jsx(y,{isDisabled:a.staff_id==="",className:"mb-4",placeholder:"Search ...",options:N,onChange:l=>{B(l.value,r)},value:N.find(l=>l.value===a.role)})})]}),e.jsx("div",{className:"w-12 flex justify-center items-center",children:e.jsx(b,{shape:"circle",size:"xs",icon:e.jsx(q,{className:"p-0 text-white"}),onClick:l=>M(r),style:{backgroundColor:"#FF5733",border:"none"},className:"ms-2 p-0",type:"button"})})]},r))})})}),e.jsx("div",{className:"flex justify-end gap-2",children:e.jsx(b,{type:"submit",variant:"solid",loading:n,children:"Save to DB"})})]})})]})]})};export{ye as default};
