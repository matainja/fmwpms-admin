import{bw as W,u as F,bA as G,r as p,j as t,b0 as H,b1 as u,b2 as I,a8 as M,B as J,aa as f}from"./index-LS0xF6a6.js";import{F as K,c as Q,a as X,b as x,e as A}from"./index.esm-BdK8EDN0.js";import{u as Z}from"./useTeam-39NMI2qP.js";import{u as R}from"./useDepartment-F5dLconr.js";import{d as g,a as b}from"./defaultErrorMessage.constant-Bll1G2ZT.js";import{u as V,p as C}from"./useNavigation-DliCxtYQ.js";import"./cloneDeep-DJN0yfLA.js";const ee=Q().shape({departmentname:A().required("Department Name Required"),departmentdescription:A().required("Department description Required").max(200,"Department description must be at most 200 characters")}),de=({actionType:d="",onViewChange:o})=>{const{type:j,id:D}=W(),S=F(e=>e.teamOption),h=F(e=>e.year),m=F(G(String(D))),[w,P]=p.useState({departmentname:"",departmentdescription:""}),[N,v]=p.useState([{value:"",label:"",team_id:""}]),[T,Y]=p.useState([]),{createTeamOption:q}=Z(),{addDepartment:z,editDepartment:B,editDepartmentTeam:O,removeDepartmentTeam:$}=R(),{Navigate:k}=V(),_=p.useRef(!0);p.useEffect(()=>{const e=async()=>{await q(),_.current=!1};S.length===0?(_.current=!0,e()):_.current=!1},[]),p.useEffect(()=>{if(d==="editDepartment"||d==="editDepartmentTeam"){P({departmentname:(m==null?void 0:m.name)||"",departmentdescription:(m==null?void 0:m.description)||""});const e=(m==null?void 0:m.team)||[],s=e.map(n=>({label:n.name,value:n.name,team_id:n.id}));v(s);const c=e.map(n=>Number(n.id));Y(c)}else v([])},[]);const y=e=>{v(e)},L=e=>{const s=new Set(T),c=new Set(e),n=e.filter(a=>!s.has(a)),l=T.filter(a=>!c.has(a));return{added:n,removed:l}},U=async e=>{const{departmentname:s,departmentdescription:c}=e,n=N.map(a=>Number(a.team_id)),l={department_name:s,year:h.selectedYear,description:c,team_id:n};if(j==="add"){const a=await z(l);(a==null?void 0:a.status)==="success"&&k(C),f((a==null?void 0:a.status)||b,(a==null?void 0:a.message)||g)}if(d==="editDepartmentTeam"){const{added:a,removed:i}=L(n);if(i.length>0){const E={department_id:String(D),year:h.selectedYear,team_id:i},r=await $(E);if((r==null?void 0:r.status)!=="success"){f((r==null?void 0:r.status)||b,(r==null?void 0:r.message)||g);return}}if(a.length>0){const E={department_id:String(D),year:h.selectedYear,team_id:a},r=await O(E);if((r==null?void 0:r.status)!=="success"){f((r==null?void 0:r.status)||b,(r==null?void 0:r.message)||g);return}}o==null||o(),f("success","Update Successfull")}if(d==="editDepartment"){const a={department_id:String(D),department_name:s,year:h.selectedYear,description:c},i=await B(a);(i==null?void 0:i.status)==="success"&&(o==null||o()),f((i==null?void 0:i.status)||b,(i==null?void 0:i.message)||g)}};return t.jsxs("div",{children:[j==="add"&&t.jsx("h5",{className:"mb-4",children:"Add Department"}),d!==""&&t.jsx("h5",{className:"mb-4",children:"Edit Department"}),t.jsx(K,{initialValues:w,enableReinitialize:!0,validationSchema:ee,onSubmit:async(e,{setSubmitting:s})=>{await U(e),setTimeout(()=>{s(!1)},400)},children:({errors:e,touched:s,setFieldValue:c,isSubmitting:n})=>t.jsx(X,{children:t.jsxs(H,{children:[j==="add"&&t.jsxs(t.Fragment,{children:[t.jsx(u,{label:"Department Name",invalid:e.departmentname&&s.departmentname,errorMessage:e.departmentname,children:t.jsx(x,{type:"text",name:"departmentname",placeholder:"Department Name",component:I})}),t.jsx(u,{label:"Department Description",invalid:e.departmentdescription&&s.departmentdescription,errorMessage:e.departmentdescription,children:t.jsx(x,{name:"departmentdescription",as:"textarea",placeholder:"Department description",className:"input input-md h-11 focus:ring-green-700 focus-within:ring-green-700 focus-within:border-green-700 focus:border-green-700border rounded-md p-3 w-full focus:border-green-700"})}),t.jsx(u,{label:"Select Team Name",children:t.jsx(M,{isMulti:!0,placeholder:"Please Select",options:S,onChange:l=>y(l),value:N})})]}),d==="editDepartment"&&t.jsxs(t.Fragment,{children:[t.jsx(u,{label:"Department Name",invalid:e.departmentname&&s.departmentname,errorMessage:e.departmentname,children:t.jsx(x,{type:"text",name:"departmentname",placeholder:"Department Name",component:I})}),t.jsx(u,{label:"Department Description",invalid:e.departmentdescription&&s.departmentdescription,errorMessage:e.departmentdescription,children:t.jsx(x,{name:"departmentdescription",as:"textarea",placeholder:"Department description",className:"input input-md h-11 focus:ring-green-700 focus-within:ring-green-700 focus-within:border-green-700 focus:border-green-700border rounded-md p-3 w-full focus:border-green-700"})})]}),d==="editDepartmentTeam"&&t.jsx(t.Fragment,{children:t.jsx(u,{label:"Select Team Name",children:t.jsx(M,{isMulti:!0,placeholder:"Please Select",options:S,onChange:l=>y(l),value:N})})}),t.jsx("div",{className:"flex justify-end gap-2",children:t.jsx(J,{type:"submit",variant:"solid",loading:n,children:"Save"})})]})})})]})};export{de as default};
