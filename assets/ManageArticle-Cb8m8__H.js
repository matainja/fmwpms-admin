import{r as m,j as e,cv as Y,cw as Z,A as $,D as F,cT as J,B as p,ae as Q,cy as ee,bh as P,bZ as K,T as O,bP as ae,cz as te,aa as D,u as E,cU as se,a7 as _,b0 as z,b1 as f,b2 as M,b9 as V,aU as ie}from"./index-DYb8bw_4.js";import{A as re}from"./AdaptableCard-D96jvxJg.js";import"./SvgIcon-vKrz22DH.js";import{C as le}from"./Views-9pYmlE2y.js";import{T as ne}from"./TextEllipsis-BNrTqlQe.js";import{U as ce}from"./UsersAvatarGroup-6pC0iCLz.js";import{u as U}from"./useArticle-9_KeJG1e.js";import{u as oe,G as H,H as me,I as de}from"./useNavigation-DuIW6UbI.js";import{d as k,a as w}from"./defaultErrorMessage.constant-Bll1G2ZT.js";import{u as ge}from"./useAccessibility-cJuJwAXb.js";import{F as B,c as W,a as G,b as I,e as X,g as ue}from"./index.esm-DAip3kWX.js";import{N as xe}from"./NotFound-DQ0L8lwt.js";import"./cloneDeep-DJN0yfLA.js";import"./useThemeClass-DdG72KGv.js";import"./acronym-BENdJEjV.js";import"./lodash-BWds4SLg.js";import"./DoubleSidedImage-BED3Xc-y.js";const he=({data:s,onOpen:h})=>{var A,C;const[d,l]=m.useState(!1),{deleteArticleCategory:g,deleteArticle:j}=U(),{Navigate:o}=oe(),{canAccess:n}=ge(),c=()=>{l(!d)},u=(a,t)=>{o(me,t,a)},y=(a,t,i)=>{a.stopPropagation(),o(H,i,t,"edit")},x=a=>{o(H,"-1",a,"add")},N=async(a,t)=>{a.stopPropagation();const i=await j(t);(i==null?void 0:i.status)==="success"&&o(de),D((i==null?void 0:i.status)||w,(i==null?void 0:i.message)||k)},b=()=>{h("rename",s.value)},R=async()=>{const a={categoryId:s.categoryId||""},t=await g(a);D((t==null?void 0:t.status)||w,(t==null?void 0:t.message)||k)};return e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1 cursor-pointer select-none w-80",onClick:c,children:[e.jsx("span",{className:"text-lg",children:d?e.jsx(Y,{}):e.jsx(Z,{})}),e.jsx("span",{children:e.jsx($,{className:"mr-4",src:s.categoryImg})}),e.jsx("h5",{children:s.label}),e.jsxs("span",{children:["(",(A=s==null?void 0:s.articles)==null?void 0:A.length,")"]})]}),e.jsx("hr",{className:"mx-3 w-full"}),e.jsxs(F,{placement:"bottom-end",renderTitle:e.jsx(p,{shape:"circle",variant:"plain",icon:e.jsx(Q,{})}),children:[e.jsx(F.Item,{eventKey:"addArticle",onClick:()=>x(s.value),children:"Add article"}),e.jsx(F.Item,{eventKey:"rename",onClick:b,children:"Rename"}),n(J)&&e.jsx(e.Fragment,{children:e.jsx(F.Item,{eventKey:"delete",onClick:R,children:"Delete"})})]})]}),e.jsxs(ee.div,{className:"grid xl:grid-cols-4 lg:grid-cols-3 md:grid-cols-2 grid-cols-1 gap-4 mt-4",initial:{opacity:0,height:0,overflow:"hidden"},animate:{opacity:d?0:1,height:d?0:"auto"},transition:{duration:.15},children:[(s==null?void 0:s.articles.length)===0&&e.jsx(P,{clickable:!0,className:"group border-dashed border-2 hover:border-indigo-600",onClick:()=>x(s.value),children:e.jsxs("div",{className:"flex flex-col justify-center items-center py-5",children:[e.jsx("div",{className:"p-4 border-2 border-dashed rounded-full border-gray-200 dark:border-gray-600 group-hover:border-indigo-600",children:e.jsx(K,{className:"text-4xl text-gray-200 dark:text-gray-600 group-hover:text-indigo-600"})}),e.jsx("p",{className:"mt-5 font-semibold",children:"Add article"})]})}),(C=s==null?void 0:s.articles)==null?void 0:C.map(a=>e.jsxs(P,{bordered:!0,onClick:()=>u(s.value,a.id),className:"cursor-pointer",children:[e.jsx("h6",{className:"truncate mb-4 cursor-pointer",children:a.title}),e.jsx("div",{className:"min-h-[60px]",children:e.jsx(ne,{text:a.content.replace(/<[^>]*>?/gm,""),maxTextCount:120})}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(ce,{avatarProps:{size:25},users:a.authors||[]}),e.jsxs("div",{className:"flex",children:[e.jsx(O,{title:"Delete",children:e.jsx(p,{shape:"circle",variant:"plain",size:"sm",icon:e.jsx(ae,{}),onClick:t=>N(t,a.id)})}),e.jsx(O,{title:"Edit",children:e.jsx(p,{shape:"circle",variant:"plain",size:"sm",icon:e.jsx(te,{}),onClick:t=>y(t,a.category,a.id)})})]})]})]},a.id))]})]})},pe=({onOpen:s})=>e.jsxs("div",{className:"flex items-center justify-between mb-4 gap-3",children:[e.jsx("div",{className:"mb-4 lg:mb-0",children:e.jsx("h3",{children:"Manage Article"})}),e.jsx(p,{size:"sm",variant:"solid",onClick:()=>s("add"),children:"Add category"})]}),je=1,q=1,fe=W().shape({imageFile:ue().min(je,"At least one file uploaded!"),categoryName:X().required("Please input category name")}),ye=W().shape({categoryName:X().required("Please input category name")}),Ne=({type:s,categoryName:h,open:d,onClose:l})=>{const g=m.useRef(!0),j=E(a=>a.articleCategory),o=E(se(h||"")),[n,c]=m.useState({avatarImg:null,imageFile:[],categoryName:""}),{getArticleCategory:u,addArticleCategory:y,editArticleCategory:x}=U(),N=async()=>{await u()};j.length===0&&s==="rename"&&g.current&&(N(),g.current=!1);const b=m.useRef(!1);m.useEffect(()=>{s==="add"&&c({avatarImg:null,imageFile:[],categoryName:""})},[s]),m.useEffect(()=>{o.length>0&&c({avatarImg:o[0].image,imageFile:[],categoryName:o[0].name})},[h]);const R=a=>{a.length>0&&(s==="rename"&&(b.current=!0),c({...n,imageFile:a,avatarImg:URL.createObjectURL(a[0])}))},A=a=>{let t=!0;const i=["image/jpeg","image/png"];if(a)for(const r of a)i.includes(r.type)||(t="Please upload a .jpeg or .png file!");return t},C=(a,t)=>{let i=!0;const r=["image/jpeg","image/png"];if(t.length>=q)return`You can only upload ${q} file(s)`;if(a)for(const v of a)r.includes(v.type)||(i="Please upload a .jpeg or .png file!");return i};return e.jsxs(e.Fragment,{children:[s==="add"&&e.jsxs(_,{isOpen:d,onClose:l,onRequestClose:l,children:[e.jsx("h5",{className:"mb-4",children:"Add Category"}),e.jsx(B,{enableReinitialize:!0,initialValues:n,validationSchema:fe,onSubmit:async(a,{setSubmitting:t})=>{t(!0);const i={name:a.categoryName||"",image:a.imageFile[0]},r=await y(i);(r==null?void 0:r.status)==="success"&&l(),D((r==null?void 0:r.status)||w,(r==null?void 0:r.message)||k),t(!1)},children:({values:a,touched:t,errors:i,resetForm:r,isSubmitting:v})=>e.jsx(G,{children:e.jsxs(z,{children:[e.jsx(f,{asterisk:!0,label:"Category Name",invalid:i.categoryName&&t.categoryName,errorMessage:i.categoryName,children:e.jsx(I,{type:"text",name:"categoryName",placeholder:"Enter category name",component:M})}),e.jsx(f,{asterisk:!0,label:"Upload",invalid:!!(i.imageFile&&t.imageFile),errorMessage:i.imageFile,children:e.jsx(I,{name:"imageFile",children:({field:S,form:T})=>e.jsx(V,{beforeUpload:C,fileList:a.imageFile,onChange:L=>T.setFieldValue(S.name,L),onFileRemove:L=>T.setFieldValue(S.name,L)})})}),e.jsxs(f,{className:"text-right mt-6",children:[e.jsx(p,{size:"sm",className:"ltr:mr-2 rtl:ml-2",variant:"plain",onClick:l,children:"Cancel"}),e.jsx(p,{variant:"solid",type:"submit",loading:v,children:"Submit"})]})]})})})]}),s==="rename"&&e.jsxs(_,{isOpen:d,onClose:l,onRequestClose:l,children:[e.jsx("h5",{className:"mb-4",children:"Rename Category"}),e.jsx(B,{enableReinitialize:!0,initialValues:n,validationSchema:ye,onSubmit:async(a,{setSubmitting:t})=>{t(!0),console.log(a);const i={categoryId:String(o[0].id),name:a.categoryName||"",image:a.imageFile[0],flag:b.current?1:0},r=await x(i);(r==null?void 0:r.status)==="success"&&l(),D((r==null?void 0:r.status)||w,(r==null?void 0:r.message)||k),t(!1)},children:({values:a,touched:t,errors:i,resetForm:r,isSubmitting:v})=>e.jsx(G,{children:e.jsxs(z,{children:[e.jsx(f,{asterisk:!0,label:"Category Name",invalid:i.categoryName&&t.categoryName,errorMessage:i.categoryName,children:e.jsx(I,{type:"text",name:"categoryName",placeholder:"Enter category name",component:M})}),e.jsx(f,{asterisk:!0,label:"Upload",invalid:!!(i.imageFile&&t.imageFile),errorMessage:i.imageFile,children:e.jsx(I,{name:"imageFile",children:({field:S,form:T})=>e.jsx(V,{className:"cursor-pointer",showList:!1,uploadLimit:1,beforeUpload:A,onChange:R,children:e.jsx($,{size:80,src:a.avatarImg,icon:e.jsx(K,{})})})})}),e.jsxs(f,{className:"text-right mt-6",children:[e.jsx(p,{size:"sm",className:"ltr:mr-2 rtl:ml-2",variant:"plain",onClick:l,children:"Cancel"}),e.jsx(p,{variant:"solid",type:"submit",loading:v,children:"Submit"})]})]})})})]})]})},ve=({data:s})=>{const[h,d]=m.useState(!1),[l,g]=m.useState(!1),[j,o]=m.useState("add"),[n,c]=m.useState(""),u=(x,N)=>{o(x),g(!0),c(N||"")},y=()=>{g(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(Ne,{type:j,categoryName:n,open:l,onClose:y}),e.jsx(pe,{onOpen:u}),e.jsxs(ie,{loading:h,children:[s.length===0&&e.jsx(xe,{}),s.length!==0&&s.map(x=>e.jsx(he,{data:x,onOpen:u},x.value))]})]})},ze=s=>{const[h,d]=m.useState([]),l=E(n=>n.article)||[],g=E(n=>n.articleCategory)||[],{getArticle:j,getArticleCategory:o}=U();return m.useEffect(()=>{(async()=>{await j(),await o()})()},[]),m.useEffect(()=>{const n=g.map(c=>({label:c.name,value:c.name,categoryId:String(c.id),categoryImg:c.image,articles:l.filter(u=>u.category_id===c.id&&u.category===c.name)}));d(n)},[l,g]),e.jsx(le,{children:e.jsx(re,{children:e.jsx(ve,{data:h})})})};export{ze as default};
