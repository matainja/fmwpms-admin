import{bA as R,r as c,h as L,u as j,bc as P,cX as T,j as e,b0 as z,b1 as p,b2 as _,a8 as $,B as A,aa as E}from"./index-Df7F332m.js";import{A as H}from"./AdaptableCard-z7BGjZuK.js";import{R as O}from"./SvgIcon-CQcPbuhV.js";import{C as W}from"./Views-cPxQQlqC.js";import{F as X,c as G,a as J,b as y,e as C}from"./index.esm-Dj8_cvlD.js";import{R as K}from"./index-BO7qGiNs.js";import{u as Q}from"./useArticle-DE2Qih8w.js";import{u as U,I as N}from"./useNavigation-C3EE1y9N.js";import{d as S,a as F}from"./defaultErrorMessage.constant-Bll1G2ZT.js";import"./cloneDeep-DJN0yfLA.js";import"./useThemeClass-D8-ALEtE.js";const Y=G().shape({title:C().required("Title required"),category:C().required("Category required"),content:C().required("Content required")}),Z=({view:b})=>{const{label:V,mode:o,id:u}=R(),[r,x]=c.useState({title:"",content:"",category:""}),[l,h]=c.useState([]);L();const D=j(t=>t.article)||[],g=j(t=>t.articleCategory)||[],v=c.useRef(!0),{getArticle:I,addArticle:q,editArticle:k,getArticleCategory:B}=Q();P();const{Navigate:w}=U();c.useEffect(()=>{const t=async()=>{await I()},i=async()=>{await B()};D.length===0&&t(),g.length===0?i():v.current=!1},[]),c.useEffect(()=>{if(g.length>0){const t=g.map(i=>({label:i.name,value:i.name,id:i.id}));h(t)}},[g]);const d=j(t=>T(t.article,u||""));c.useEffect(()=>{o==="edit"&&d&&(x({title:d.title||"",category:String(d.category_id)||"",content:d.content||""}),v.current=!1)},[o,d]);const M=async(t,i)=>{if(i(!0),o==="add"){const s={title:t.title,content:t.content,category:t.category},a=await q(s);(a==null?void 0:a.status)==="success"&&w(N),E((a==null?void 0:a.status)||F,(a==null?void 0:a.message)||S)}if(o==="edit"){const s={id:u||"",title:t.title,content:t.content,category:t.category},a=await k(s);(a==null?void 0:a.status)==="success"&&w(N),E((a==null?void 0:a.status)||F,(a==null?void 0:a.message)||S)}i(!1)};return e.jsx(X,{enableReinitialize:!0,initialValues:r,validationSchema:Y,onSubmit:(t,{setSubmitting:i})=>{M(t,i)},children:({values:t,touched:i,errors:s,isSubmitting:a})=>e.jsx(J,{children:b==="preview"?e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"mb-4",children:t.title}),e.jsx("div",{className:"prose dark:prose-invert max-w-none",children:K(t.content||"")})]}):e.jsxs(z,{children:[e.jsx(p,{label:"Title",invalid:s.title&&i.title,errorMessage:s.title,children:e.jsx(y,{autoComplete:"off",name:"title",component:_})}),e.jsx(p,{label:"Category",invalid:s.category&&i.category,errorMessage:s.category,children:e.jsx(y,{name:"category",children:({field:m,form:f})=>e.jsx($,{placeholder:"Category",field:m,form:f,options:l,value:l.filter(n=>String(n.id)===String(t.category)),onChange:n=>f.setFieldValue(m.name,n==null?void 0:n.id)})})}),e.jsx(p,{label:"Content",className:"mb-0",labelClass:"!justify-start",invalid:s.content&&i.content,errorMessage:s.content,children:e.jsx(y,{name:"content",children:({field:m,form:f})=>e.jsx(O,{value:m.value,onChange:n=>f.setFieldValue(m.name,n)})})}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(A,{loading:a,variant:"solid",children:"Save to DB"})})]})})})},me=b=>{const{label:V,mode:o,id:u}=R(),[r,x]=c.useState(o||"add"),l=h=>{x(h)};return e.jsx(W,{children:e.jsx(H,{children:e.jsxs("div",{className:"max-w-[800px] mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{children:[r==="edit"&&e.jsx("span",{children:"Edit Article category"}),r==="add"&&e.jsx("span",{children:"Add Article category"}),r==="preview"&&e.jsx("span",{children:"Preview Article category"})]}),r==="preview"?e.jsx(A,{size:"sm",onClick:()=>l(u!=="-1"?"edit":"add"),children:"Back"}):e.jsx(A,{size:"sm",onClick:()=>l("preview"),children:"Preview"})]}),e.jsx(Z,{view:r})]})})})};export{me as default};
