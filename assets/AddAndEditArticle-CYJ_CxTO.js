import{bB as R,r as c,h as L,u as j,bh as P,c_ as T,j as e,b5 as _,b6 as p,b7 as z,a8 as $,B as b,aa as E}from"./index-Dles2GGc.js";import{A as H}from"./AdaptableCard-Dd0_tlnt.js";import{R as O}from"./SvgIcon-kVAzcj_I.js";import{C as W}from"./Views-BeAgtkwm.js";import{F as G,c as J,a as K,b as y,e as C}from"./index.esm-BNKjJ-ZT.js";import{R as Q}from"./index-D40Cld0t.js";import{u as U}from"./useArticle-BW5DlOna.js";import{u as X,I as N}from"./useNavigation-SaAlQaOB.js";import{d as S,a as F}from"./defaultErrorMessage.constant-Bll1G2ZT.js";import"./cloneDeep-DJN0yfLA.js";import"./useThemeClass-Bv4J3TKz.js";const Y=J().shape({title:C().required("Title required"),category:C().required("Category required"),content:C().required("Content required")}),Z=({view:v})=>{const{label:V,mode:o,id:u}=R(),[r,h]=c.useState({title:"",content:"",category:""}),[l,x]=c.useState([]);L();const D=j(t=>t.article)||[],g=j(t=>t.articleCategory)||[],A=c.useRef(!0),{getArticle:I,addArticle:q,editArticle:B,getArticleCategory:k}=U();P();const{Navigate:w}=X();c.useEffect(()=>{const t=async()=>{await I()},i=async()=>{await k()};D.length===0&&t(),g.length===0?i():A.current=!1},[]),c.useEffect(()=>{if(g.length>0){const t=g.map(i=>({label:i.name,value:i.name,id:i.id}));x(t)}},[g]);const d=j(t=>T(t.article,u||""));c.useEffect(()=>{o==="edit"&&d&&(h({title:d.title||"",category:String(d.category_id)||"",content:d.content||""}),A.current=!1)},[o,d]);const M=async(t,i)=>{if(i(!0),o==="add"){const s={title:t.title,content:t.content,category:t.category},a=await q(s);(a==null?void 0:a.status)==="success"&&w(N),E((a==null?void 0:a.status)||F,(a==null?void 0:a.message)||S)}if(o==="edit"){const s={id:u||"",title:t.title,content:t.content,category:t.category},a=await B(s);(a==null?void 0:a.status)==="success"&&w(N),E((a==null?void 0:a.status)||F,(a==null?void 0:a.message)||S)}i(!1)};return e.jsx(G,{enableReinitialize:!0,initialValues:r,validationSchema:Y,onSubmit:(t,{setSubmitting:i})=>{M(t,i)},children:({values:t,touched:i,errors:s,isSubmitting:a})=>e.jsx(K,{children:v==="preview"?e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"mb-4",children:t.title}),e.jsx("div",{className:"prose dark:prose-invert max-w-none",children:Q(t.content||"")})]}):e.jsxs(_,{children:[e.jsx(p,{label:"Title",invalid:s.title&&i.title,errorMessage:s.title,children:e.jsx(y,{autoComplete:"off",name:"title",component:z})}),e.jsx(p,{label:"Category",invalid:s.category&&i.category,errorMessage:s.category,children:e.jsx(y,{name:"category",children:({field:m,form:f})=>e.jsx($,{placeholder:"Category",field:m,form:f,options:l,value:l.filter(n=>String(n.id)===String(t.category)),onChange:n=>f.setFieldValue(m.name,n==null?void 0:n.id)})})}),e.jsx(p,{label:"Content",className:"mb-0",labelClass:"!justify-start",invalid:s.content&&i.content,errorMessage:s.content,children:e.jsx(y,{name:"content",children:({field:m,form:f})=>e.jsx(O,{value:m.value,onChange:n=>f.setFieldValue(m.name,n)})})}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(b,{loading:a,variant:"solid",children:"Save to DB"})})]})})})},me=v=>{const{label:V,mode:o,id:u}=R(),[r,h]=c.useState(o||"add"),l=x=>{h(x)};return e.jsx(W,{children:e.jsx(H,{children:e.jsxs("div",{className:"max-w-[800px] mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{children:[r==="edit"&&e.jsx("span",{children:"Edit Article category"}),r==="add"&&e.jsx("span",{children:"Add Article category"}),r==="preview"&&e.jsx("span",{children:"Preview Article category"})]}),r==="preview"?e.jsx(b,{size:"sm",onClick:()=>l(u!=="-1"?"edit":"add"),children:"Back"}):e.jsx(b,{size:"sm",onClick:()=>l("preview"),children:"Preview"})]}),e.jsx(Z,{view:r})]})})})};export{me as default};
