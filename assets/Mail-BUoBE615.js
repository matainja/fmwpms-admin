import{j as e,c as R,r as l,h as D,u as g,cX as z,b0 as K,b1 as E,b2 as Q,a8 as ee,B as b,cY as V,aa as I,cZ as q,c_ as se,a7 as ae,c$ as te,d0 as le,a4 as ie,bh as H,A,d1 as re,bw as T,bc as G,S as U,aU as X,d2 as ne,P as W,bL as ce,d3 as oe,d4 as de,v as fe,d5 as me}from"./index-LS0xF6a6.js";import{A as xe}from"./AdaptableCard-CMoK7OkU.js";import{R as ue}from"./SvgIcon-CkoZ91rj.js";import"./Views-CPmH8doF.js";import{F as he,c as je,a as pe,b as L,e as B,u as ge}from"./index.esm-BdK8EDN0.js";import{u as be}from"./useStaff-q9YF5Gki.js";import{u as F}from"./useMail-BQjLRMWC.js";import{d as ve,a as Ne}from"./defaultErrorMessage.constant-Bll1G2ZT.js";import{H as Me}from"./Header-CoBa_O2o.js";import{g as ye,a as we}from"./index-B6sXUSRw.js";import{D as Ce}from"./DoubleSidedImage-DCxLBxa4.js";import{u as Y}from"./useResponsive-BOplVZXA.js";import{R as ke}from"./index-Xum9MjHC.js";import{u as De,e as Se}from"./useNavigation-DliCxtYQ.js";import"./cloneDeep-DJN0yfLA.js";import"./useThemeClass-UiXQj2YI.js";const Re=({className:c,asElement:s="span",icon:t,children:r})=>e.jsxs(s,{className:R("flex items-center gap-2",c),children:[t,r]}),_e=je().shape({title:B().required("Title Required"),message:B().max(200,"Message must be at most 200 characters long")}),Ee=()=>{const{values:c}=ge(),s=D();return l.useEffect(()=>{s(V(c))},[c,s]),null},O=l.forwardRef((c,s)=>{const{mode:t="new",chatId:r,mailReceiver:i,updateReply:d,onDialogClose:a}=c,m=l.useRef(null),f=l.useRef(null);l.useImperativeHandle(s,()=>({formikRef:m.current,editorRef:f.current}));const j=D(),v=g(n=>n.staffOption),h=g(z(r||"")),p=g(n=>n.draftMailList),[M,k]=l.useState({title:"",send:[],message:""}),{createStaffOption:o}=be(),{addMail:y,getMailById:x}=F();l.useEffect(()=>{const n=async()=>{await o()};v.length===0&&n(),t==="reply"&&k({...M,title:(h==null?void 0:h.chat_name)||""})},[]),l.useEffect(()=>{if(p.selectedMail!==null){const n=p.draftMails[p.selectedMail];k({...M,title:n.title,send:n.send,message:n.message})}},[p.selectedMail]);const w=n=>{j(V(n))},J=async n=>{if(t==="reply"){const N={reciver_staff_id:i||"",chat_id:r||"",name:"",title:(h==null?void 0:h.chat_name)||"",message:n.message,files:[]};await P(N),await x(r||""),I("success","Reply send successfully"),d==null||d(!1)}if(t==="new"){let N=!0;if(n.send.map(async C=>{const S={reciver_staff_id:C.staff_id,chat_id:"",name:"",title:n.title,message:n.message,files:[]},u=await P(S);if((u==null?void 0:u.status)!=="success"){N=!1,I((u==null?void 0:u.status)||Ne,(u==null?void 0:u.message)||ve);return}}),!N)return;I("success","Message send successfully"),p.selectedMail!==null&&j(q(p.selectedMail)),a==null||a()}},P=async n=>await y(n);return e.jsx(he,{enableReinitialize:!0,innerRef:m,initialValues:M,validationSchema:_e,onSubmit:(n,{resetForm:N,setSubmitting:C})=>{J(n),setTimeout(()=>{C(!1),N()},400)},children:({values:n,touched:N,errors:C})=>e.jsxs(pe,{children:[e.jsx(Ee,{}),e.jsxs(K,{className:"max-h-[400px] overflow-y-auto px-1",children:[e.jsx(E,{className:t==="reply"?"!hidden":"",label:"Title",labelClass:"!justify-start",invalid:C.title&&N.title,errorMessage:C.title,children:e.jsx(L,{autoComplete:"off",name:"title",placeholder:"Please Enter Title",component:Q})}),e.jsx(E,{className:t==="reply"?"!hidden":"",label:"To",labelClass:"!justify-start",children:e.jsx(L,{name:"send",children:({field:S,form:u})=>e.jsx(ee,{isMulti:!0,placeholder:"Please Select",onChange:_=>{u.setFieldValue("send",_),w(n)},value:n.send,options:v})})}),e.jsx(E,{label:t==="new"?"Message":"",className:"mb-0",labelClass:"!justify-start",invalid:C.message&&N.message,errorMessage:C.message,children:e.jsx(L,{name:"message",children:({field:S,form:u})=>e.jsx(ue,{ref:f,value:S.value,onChange:_=>{u.setFieldValue(S.name,_),w(n)}})})})]}),t==="new"&&e.jsxs("div",{className:"text-right mt-4",children:[e.jsx(b,{type:"button",className:"ltr:mr-2 rtl:ml-2",variant:"plain",onClick:a,children:"Discard"}),e.jsx(b,{type:"submit",variant:"solid",children:"Send"})]})]})})});O.displayName="MailEditor";const Ie=c=>{const s=l.useRef(null),t=D(),[r,i]=l.useState(!1),d=g(f=>f.draftMailList);l.useEffect(()=>{d.selectedMail!==null&&d.selectedMail>=0&&i(!0)},[d.selectedMail]);const a=()=>{i(!0),t(te())},m=()=>{i(!1),t(le())};return e.jsxs("div",{className:"mr-1",children:[e.jsx(b,{variant:"solid",icon:e.jsx(se,{}),onClick:a}),e.jsxs(ae,{isOpen:r,width:1e3,height:550,onClose:m,onRequestClose:m,children:[e.jsx("h5",{className:"mb-4",children:"Message"}),e.jsx("div",{children:e.jsx(O,{ref:s,mode:"new",onDialogClose:m})})]})]})},Le=({deleteIndex:c})=>{const s=D(),t=(r,i)=>{i.stopPropagation(),s(q(r))};return e.jsx(b,{shape:"circle",variant:"plain",icon:e.jsx(we,{}),onClick:r=>t(c,r)})},Ae=c=>{const s=document.createElement("div");return s.innerHTML=c,s.textContent||s.innerText||""},He=c=>{const[s,t]=l.useState(!1),r=D(),i=g(f=>f.draftMailList)||[],d=()=>{t(!0)},a=()=>{t(!1)},m=f=>{r(re(f)),a()};return e.jsxs("div",{children:[e.jsx(b,{icon:e.jsx(ye,{}),onClick:d}),e.jsxs(ie,{title:"All Message Draft",isOpen:s,onClose:a,onRequestClose:a,children:[i.draftMails.length===0&&e.jsx("div",{children:"No Drafts Found..."}),i.draftMails.length!==0&&i.draftMails.map((f,j)=>e.jsxs(H,{clickable:!0,className:"hover:shadow-lg transition duration-150 ease-in-out mb-2",onClick:()=>m(j),children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(Me,{title:f.title===""?"No content found...":f.title,titleTag:"h5"}),e.jsx(Le,{deleteIndex:j})]}),e.jsx(A.Group,{chained:!0,maxCount:4,omittedAvatarProps:{shape:"circle"},omittedAvatarTooltip:!0,children:f.send.map((v,h)=>e.jsx(A,{shape:"circle",src:v.staff_img},h))}),f.message===""?e.jsx("p",{children:"No content found..."}):e.jsx("p",{className:"w-full truncate text-sm",children:Ae(f.message||"")})]},j))]})]})},Te=/(<([^>]+)>)/gi,Fe=()=>e.jsx(b,{icon:e.jsx(ne,{}),size:"sm",variant:"plain",shape:"circle"}),Oe=c=>{const{category:s,id:t}=T(),[r,i]=l.useState(""),[d,a]=l.useState(!1),[m,f]=l.useState([]),j=g(o=>o.theme.direction),v=g(o=>o.mailList),{getMail:h}=F(),p=G();l.useEffect(()=>{const o=async()=>{await h()};a(!0),m.length===0&&o(),a(!1)},[]),l.useEffect(()=>{f(v.slice().reverse())},[v]),l.useEffect(()=>{i(t!=="all"&&t||"")},[t]);const M=o=>{if(!o)return"";const y=o.replace(Te,"");return y.length>60?y.substring(0,57)+"...":y},k=o=>{p(`${W}/message/${s}/${o}`)};return e.jsxs("div",{className:R("min-w-[360px] ease-in-out duration-300 relative flex flex-auto flex-col ltr:border-r rtl:border-l border-gray-200 dark:border-gray-600",r?"hidden xl:flex":"xs:flex"),children:[e.jsxs("div",{className:"relative flex flex-0 items-center justify-between min-h-[55px] border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Fe,{}),e.jsx("h6",{children:s==null?void 0:s.toLocaleUpperCase()})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(He,{}),e.jsx(Ie,{})]})]}),e.jsx(U,{autoHide:!0,direction:j,children:e.jsx(X,{type:m.length>0?"cover":"default",spinnerClass:m.length>0?"hidden":"",loading:d,children:m.map(o=>e.jsx("div",{className:"relative flex border-b border-gray-200 dark:border-gray-600 last:border-0 hover:bg-hover",onClick:y=>k(o.chat_id),children:e.jsx("div",{className:`${String(o.chat_id)===String(t)?"bg-gray-50 dark:bg-gray-700":""} w-full py-6 pr-4 pl-5 cursor-pointer select-none hover:bg-gray-50 hover:dark:bg-gray-700 flex`,children:e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("span",{className:"font-semibold truncate text-gray-900 dark:text-gray-100",children:o.chat_name})}),e.jsx("div",{className:"flex items-center text-lg"})]}),e.jsxs("div",{className:"flex flex-auto w-full justify-between break-all",children:[e.jsx("p",{children:M(o.last_message)}),e.jsx("div",{className:"ltr:ml-2 rtl:mr-2",children:e.jsx("span",{className:"whitespace-nowrap",children:o.date})})]})]})})},o.chat_id))})})]})},$=()=>{const{smaller:c}=Y(),s=G(),t=()=>{s(`${W}/message/inbox/all`)};return c.xl?e.jsx(b,{icon:e.jsx(fe,{}),variant:"plain",shape:"circle",size:"sm",onClick:t}):e.jsx(e.Fragment,{})},Pe=({isReply:c,updateReply:s,onMailSend:t,onMailReply:r})=>{const i=()=>{s==null||s(!0),r==null||r()},d=()=>{s==null||s(!1)},a=()=>{t==null||t()};return e.jsx("div",{className:R("relative flex items-center min-h-[55px] px-4 border-b border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-800"),children:c?e.jsxs("div",{className:"flex items-center xl:justify-end justify-between gap-2 w-full",children:[e.jsx($,{}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{size:"sm",icon:e.jsx(ce,{}),onClick:d,children:"Discard"}),e.jsx(b,{variant:"solid",size:"sm",icon:e.jsx(oe,{}),onClick:a,children:"Send"})]})]}):e.jsx("div",{className:"flex items-center justify-between w-full",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{}),e.jsx(b,{size:"sm",icon:e.jsx(de,{}),onClick:i,children:e.jsx("span",{className:"hidden sm:block",children:"Reply"})})]})})})},Z=l.forwardRef((c,s)=>{const{id:t}=T(),{mails:r=[],children:i}=c,d=g(z(t||""));return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 px-4 py-8 shadow-sm border-b border-gray-200 dark:border-gray-600 md:flex items-center justify-between",children:e.jsx("h5",{children:d==null?void 0:d.chat_name})}),e.jsx(U,{ref:s,autoHide:!0,children:e.jsxs("div",{className:"m-6 h-full",children:[i,r.map((a,m)=>e.jsx("div",{className:"pb-6",children:e.jsxs(H,{children:[e.jsxs("div",{className:"md:flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(A,{shape:"circle",src:a!=null&&a.image?a.image:"/img/others/defaultUserImage.jpg"}),e.jsxs("div",{className:"ltr:ml-2 rtl:mr-2",children:[e.jsx("div",{className:"font-semibold truncate text-gray-900 dark:text-gray-100",children:a==null?void 0:a.sender_name}),e.jsxs("div",{children:["To: ",a==null?void 0:a.sender_email]})]})]}),e.jsx(Re,{icon:e.jsx(me,{className:"text-lg"}),children:e.jsx("span",{className:"font-semibold",children:a==null?void 0:a.created_at})})]}),e.jsx("div",{className:"mt-8",children:ke((a==null?void 0:a.message)||"")})]})},m))]})})]})});Z.displayName="MailDetailContent";const Be=c=>{const{id:s}=T(),t=l.useRef(null),r=l.useRef(null);D();const i=g(x=>x.currentMails),d=g(x=>x.mailList),[a,m]=l.useState(!1),[f,j]=l.useState(!1),[v,h]=l.useState(""),{getMailById:p}=F(),{larger:M}=Y(),{Navigate:k}=De();l.useEffect(()=>{const x=async()=>{await p(String(s))};m(!0),s!=="all"?(x(),j(!1)):M.md&&d.length!==0&&k(Se,String(d.slice().reverse()[0].chat_id)),m(!1)},[s,M.md,d]),l.useEffect(()=>{var w;let x=!0;i.length>0&&x&&(h(((w=i[0])==null?void 0:w.sender)||""),x=!1)},[i]);const o=x=>{j(x)},y=async()=>{var x,w;await((w=(x=r.current)==null?void 0:x.formikRef)==null?void 0:w.submitForm())};return e.jsx("div",{className:R(s!=="all"&&i&&!a?"block xl:flex":"hidden xl:flex","flex-col w-full bg-gray-100 dark:bg-gray-900"),children:s!=="all"&&i?a?e.jsx(X,{loading:!0}):e.jsxs(e.Fragment,{children:[e.jsx(Pe,{isReply:f,updateReply:o,onMailSend:y}),e.jsx(Z,{ref:t,mails:i,children:f&&e.jsx("div",{className:"pb-6",children:e.jsx(H,{children:e.jsx(O,{ref:r,chatId:s,mailReceiver:v,mode:"reply",updateReply:o})})})})]}):e.jsxs("div",{className:"flex flex-col justify-center items-center h-full",children:[e.jsx(Ce,{className:"max-w-[200px]",src:"/img/others/no-mail-selected.png",darkModeSrc:"/img/others/no-mail-selected-dark.png"}),e.jsx("div",{className:"mt-4 text-2xl font-semibold",children:"Select a message to read"})]})})},$e=c=>e.jsxs("div",{className:"flex flex-auto w-full",children:[e.jsx(Oe,{}),e.jsx(Be,{})]}),ls=c=>e.jsx(xe,{className:"h-full overflow-hidden",bodyClass:"p-0 h-full absolute inset-0 flex min-w-0 overflow-hidden",children:e.jsx($e,{})});export{ls as default};
