import{bC as L,u as y,ci as U,r as p,j as t,b5 as G,b6 as u,b7 as w,a8 as I,B as J,aa as f}from"./index-CU4jOGQJ.js";import{F as K,c as Q,a as X,b as g,e as M}from"./index.esm-B-Sdc1-1.js";import{u as Z}from"./useTeam-Cv8MU0ii.js";import{u as C}from"./useDepartment-BnSamawM.js";import{d as D,a as b}from"./defaultErrorMessage.constant-Bll1G2ZT.js";import{u as R,p as V}from"./useNavigation-DdBza-NY.js";import"./cloneDeep-DJN0yfLA.js";const ee=Q().shape({departmentname:M().required("Department Name Required"),departmentdescription:M().required("Department description Required").max(200,"Department description must be at most 200 characters")}),de=({actionType:c="",onViewChange:o})=>{const{type:j,id:x}=L(),S=y(e=>e.teamOption),h=y(e=>e.year),d=y(U(String(x))),[A,Y]=p.useState({departmentname:"",departmentdescription:""}),[v,N]=p.useState([{value:"",label:"",team_id:""}]),[F,P]=p.useState([]),{createTeamOption:q}=Z(),{addDepartment:z,editDepartment:B,editDepartmentTeam:H,removeDepartmentTeam:O}=C(),{Navigate:W}=R(),_=p.useRef(!0);p.useEffect(()=>{const e=async()=>{await q(),_.current=!1};S.length===0?(_.current=!0,e()):_.current=!1},[]),p.useEffect(()=>{if(c==="editDepartment"||c==="editDepartmentTeam"){Y({departmentname:(d==null?void 0:d.name)||"",departmentdescription:(d==null?void 0:d.description)||""});const e=(d==null?void 0:d.team)||[],n=e.map(s=>({label:s.name,value:s.name,team_id:s.id}));N(n);const l=e.map(s=>Number(s.id));P(l)}else N([])},[]);const T=e=>{N(e)},k=e=>{const n=new Set(F),l=new Set(e),s=e.filter(a=>!n.has(a)),m=F.filter(a=>!l.has(a));return{added:s,removed:m}},$=async e=>{const{departmentname:n,departmentdescription:l}=e,s=v.map(a=>Number(a.team_id)),m={department_name:n,year:h.selectedYear,description:l,team_id:s};if(j==="add"){const a=await z(m);(a==null?void 0:a.status)==="success"&&W(V),f((a==null?void 0:a.status)||b,(a==null?void 0:a.message)||D)}if(c==="editDepartmentTeam"){const{added:a,removed:i}=k(s);if(i.length>0){const E={department_id:String(x),year:h.selectedYear,team_id:i},r=await O(E);if((r==null?void 0:r.status)!=="success"){f((r==null?void 0:r.status)||b,(r==null?void 0:r.message)||D);return}}if(a.length>0){const E={department_id:String(x),year:h.selectedYear,team_id:a},r=await H(E);if((r==null?void 0:r.status)!=="success"){f((r==null?void 0:r.status)||b,(r==null?void 0:r.message)||D);return}}o==null||o(),f("success","Update Successfull")}if(c==="editDepartment"){const a={department_id:String(x),department_name:n,year:h.selectedYear,description:l},i=await B(a);(i==null?void 0:i.status)==="success"&&(o==null||o()),f((i==null?void 0:i.status)||b,(i==null?void 0:i.message)||D)}};return t.jsxs("div",{children:[j==="add"&&t.jsx("h5",{className:"mb-4",children:"Add Department"}),c!==""&&t.jsx("h5",{className:"mb-4",children:"Edit Department"}),t.jsx(K,{initialValues:A,enableReinitialize:!0,validationSchema:ee,onSubmit:async(e,{setSubmitting:n})=>{await $(e),setTimeout(()=>{n(!1)},400)},children:({errors:e,touched:n,setFieldValue:l,isSubmitting:s})=>t.jsx(X,{children:t.jsxs(G,{children:[j==="add"&&t.jsxs(t.Fragment,{children:[t.jsx(u,{label:"Department Name",invalid:e.departmentname&&n.departmentname,errorMessage:e.departmentname,children:t.jsx(g,{type:"text",name:"departmentname",placeholder:"Department Name",component:w})}),t.jsx(u,{label:"Department Description",invalid:e.departmentdescription&&n.departmentdescription,errorMessage:e.departmentdescription,children:t.jsx(g,{name:"departmentdescription",as:"textarea",placeholder:"Department description",className:"input input-md h-11 focus:ring-green-700 focus-within:ring-green-700 focus-within:border-green-700 focus:border-green-700border rounded-md p-3 w-full focus:border-green-700"})}),t.jsx(u,{label:"Select Team Name",children:t.jsx(I,{isMulti:!0,placeholder:"Please Select",options:S,onChange:m=>T(m),value:v})})]}),c==="editDepartment"&&t.jsxs(t.Fragment,{children:[t.jsx(u,{label:"Department Name",invalid:e.departmentname&&n.departmentname,errorMessage:e.departmentname,children:t.jsx(g,{type:"text",name:"departmentname",placeholder:"Department Name",component:w})}),t.jsx(u,{label:"Department Description",invalid:e.departmentdescription&&n.departmentdescription,errorMessage:e.departmentdescription,children:t.jsx(g,{name:"departmentdescription",as:"textarea",placeholder:"Department description",className:"input input-md h-11 focus:ring-green-700 focus-within:ring-green-700 focus-within:border-green-700 focus:border-green-700border rounded-md p-3 w-full focus:border-green-700"})})]}),c==="editDepartmentTeam"&&t.jsx(t.Fragment,{children:t.jsx(u,{label:"Select Team Name",children:t.jsx(I,{isMulti:!0,placeholder:"Please Select",options:S,onChange:m=>T(m),value:v,styles:{control:m=>({...m,minHeight:"40px",maxHeight:"120px",overflowY:"auto"}),valueContainer:m=>({...m,flexWrap:"wrap",maxHeight:"100px",overflow:"auto",scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}})}})})}),t.jsx("div",{className:"flex justify-end gap-2",children:t.jsx(J,{type:"submit",variant:"solid",loading:s,children:"Save"})})]})})})]})};export{de as default};
