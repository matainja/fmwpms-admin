import{cG as ve,r as C,cH as ce,cI as xe,cJ as fe,cK as ae,cL as _e,cM as de,cN as Me,cO as ye,cP as ke,bv as we,u as Z,cC as Oe,cz as ie,cE as re,cF as se,j as e,cy as me,cQ as Se,a$ as b,b0 as o,b1 as j,a8 as ne,bg as ue,B as I,aa as V}from"./index-ee-rpyvk.js";import{d as z,a as X}from"./defaultErrorMessage.constant-Bll1G2ZT.js";import{u as Pe,F as Ne,B as le}from"./useNavigation-B_1aUziW.js";import{u as $e}from"./useDepartment-DSnKOgw9.js";import{u as Ce}from"./useMPMS-BiiGNFbV.js";import{H as J}from"./Header-Dza_BrVo.js";import{F as ee,c as G,a as te,b as g,k as ge,g as je,j as B,e as S,l as pe}from"./index.esm-DJ4Ui6LF.js";import"./cloneDeep-DJN0yfLA.js";var Ie=["allowCreateWhileLoading","createOptionPosition","formatCreateLabel","isValidNewOption","getNewOptionData","onCreateOption","options","onChange"],he=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",c=arguments.length>1?arguments[1]:void 0,h=arguments.length>2?arguments[2]:void 0,P=String(s).toLowerCase(),N=String(h.getOptionValue(c)).toLowerCase(),q=String(h.getOptionLabel(c)).toLowerCase();return N===P||q===P},oe={formatCreateLabel:function(s){return'Create "'.concat(s,'"')},isValidNewOption:function(s,c,h,P){return!(!s||c.some(function(N){return he(s,N,P)})||h.some(function(N){return he(s,N,P)}))},getNewOptionData:function(s,c){return{label:c,value:s,__isNew__:!0}}};function Re(p){var s=p.allowCreateWhileLoading,c=s===void 0?!1:s,h=p.createOptionPosition,P=h===void 0?"last":h,N=p.formatCreateLabel,q=N===void 0?oe.formatCreateLabel:N,Q=p.isValidNewOption,Y=Q===void 0?oe.isValidNewOption:Q,U=p.getNewOptionData,K=U===void 0?oe.getNewOptionData:U,W=p.onCreateOption,R=p.options,x=R===void 0?[]:R,f=p.onChange,_=ve(p,Ie),w=_.getOptionValue,O=w===void 0?fe:w,L=_.getOptionLabel,H=L===void 0?xe:L,a=_.inputValue,d=_.isLoading,r=_.isMulti,t=_.value,y=_.name,m=C.useMemo(function(){return Y(a,ce(t),x,{getOptionValue:O,getOptionLabel:H})?K(a,q(a)):void 0},[q,K,H,O,a,Y,x,t]),n=C.useMemo(function(){return(c||!d)&&m?P==="first"?[m].concat(ae(x)):[].concat(ae(x),[m]):x},[c,P,d,m,x]),v=C.useCallback(function(l,M){if(M.action!=="select-option")return f(l,M);var i=Array.isArray(l)?l:[l];if(i[i.length-1]===m){if(W)W(a);else{var u=K(a,a),$={action:"create-option",name:y,option:u};f(_e(r,[].concat(ae(ce(t)),[u]),u),$)}return}f(l,M)},[K,a,r,y,m,W,f,t]);return de(de({},_),{},{options:n,onChange:v})}var Fe=C.forwardRef(function(p,s){var c=Me(p),h=Re(c);return C.createElement(ye,ke({ref:s},h))}),be=Fe;const Te=G().shape({year:S().required("Required"),kra_title:S().min(1,"too short").required("Required"),kra_weight:B().min(.001,"weight should be more than 0").max(100,"weight should be less than 100").required("Required"),objectives:je().of(G().shape({obj_title:S().required("Object Title required"),obj_weight:B().min(.001,"weight should be more than 0").max(100,"weight should be less than 100").required("Object Weight required"),Initiative:S().required("Initiative required"),kpi:S().required("KPI required"),target:B().min(.001,"Target should be more than 0").max(10001,"weight should be less than 10001").required("Target required"),Responsible:S().required("Responsible required")}))}),De=G().shape({kra_title:S().min(1,"too short").required("Required"),kra_weight:B().min(.001,"weight should be more than 0").max(100,"weight should be less than 100").required("Required")}),Ae=G().shape({objectives:je().of(G().shape({obj_title:S().required("Object Title required"),obj_weight:B().min(.001,"weight should be more than 0").max(100,"weight should be less than 100").required("Object Weight required"),Initiative:S().required("Initiative required"),kpi:S().required("KPI required"),target:B().min(.001,"Target should be more than 0").max(10001,"weight should be less than 10001").required("Target required"),Responsible:S().required("Responsible required")}))}),k=(p,s)=>{const c=pe(p.errors,s),h=pe(p.touched,s);return{errorMessage:c||"",invalid:typeof h>"u"?!1:c&&h}},ze=p=>{const{type:s,flag:c,id:h}=we(),P=Z(a=>a.mpms),{getMPMS:N,createKraMPMS:q,editKraMPMS:Q,deleteDepartmentKraMPMS:Y,addDepartmentKraMPMS:U,addObjectKraMPMS:K}=Ce(),{createDepartmentOption:W}=$e(),{Navigate:R}=Pe(),x={obj_title:"",obj_weight:0,Initiative:"",kpi:"",target:0,Responsible:""},[f,_]=C.useState({heading:"",year:"",kra_title:"",kra_weight:0,department:[],objectives:[x]}),w=C.useRef(!0),O=Z(Oe(c||"",h||"")),L=Z(a=>a.departmentOption),H=Z(a=>a.year.yearOption);return C.useEffect(()=>{const a=async()=>{await W()};L.length===0&&a();const d=async()=>{await N()};P.length===0&&d()},[]),C.useEffect(()=>{if(s===ie)O.length>0&&w.current&&(w.current=!1,_({...f,heading:c||"",kra_title:O[0].kra_title,kra_weight:O[0].kra_weight||0}));else if(s===re){if(O.length>0&&w.current){w.current=!1;const a=O[0].departments.map(({department_id:d,department_name:r})=>({value:r,label:r,departmentId:d}));_({...f,heading:c||"",department:a||[]})}}else s===se?w.current&&(w.current=!1,_({...f,objectives:[x]})):w.current&&(w.current=!1,_({...f,heading:c||""}))},[s,c,O]),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 lg:mb-0",children:[s===me&&e.jsx(J,{title:`MPMS ${c} Create`}),s===ie&&e.jsx(J,{title:`MPMS ${c} KRA Edit`}),s===re&&e.jsx(J,{title:`MPMS ${c} KRA Department Add and Edit`}),s===se&&e.jsx(J,{title:`MPMS ${c} KRA Objective Add`}),s===Se&&e.jsx(J,{title:`MPMS ${c} KRA Objective Edit`})]}),s===me&&e.jsx(ee,{enableReinitialize:!0,initialValues:f,validationSchema:Te,onSubmit:async(a,{setSubmitting:d})=>{const r={kra_title:a.kra_title,kra_weight:a.kra_weight||0,mpms_id:h||"",year:Number(a.year)||0,departments:a.department.map(y=>y==null?void 0:y.departmentId),objective:a.objectives},t=await q(r);V((t==null?void 0:t.status)||X,(t==null?void 0:t.message)||z),(t==null?void 0:t.status)==="success"&&R(Ne),setTimeout(()=>{d(!1)},400)},children:({values:a,touched:d,errors:r,isSubmitting:t,resetForm:y})=>{const m=a.objectives;return e.jsxs(te,{className:"mt-4",children:[e.jsxs(b,{className:"grid  md:grid-cols-2 gap-4",children:[e.jsx(o,{label:"Form Name",children:e.jsx(g,{type:"text",name:"heading",placeholder:"Enter Form name",component:j,values:a.heading,readOnly:!0})}),e.jsx(o,{label:"Year",invalid:r.year&&d.year,errorMessage:r.year,children:e.jsx(g,{name:"year",children:({field:n,form:v})=>e.jsx(ne,{field:n,form:v,options:H,value:H.filter(l=>String(l.value)===String(a.year)),onChange:l=>v.setFieldValue(n.name,l==null?void 0:l.value)})})})]}),e.jsxs(b,{className:"grid  md:grid-cols-2 gap-4",children:[e.jsx(o,{label:"Key Result Areas",invalid:r.kra_title&&d.kra_title,errorMessage:r.kra_title,children:e.jsx(g,{type:"text",autoComplete:"off",name:"kra_title",placeholder:"Enter Key Result Areas Title",component:j})}),e.jsx(o,{label:"Weight for KRA",invalid:r.kra_weight&&d.kra_weight,errorMessage:r.kra_weight,children:e.jsx(g,{type:"number",autoComplete:"off",name:"kra_weight",placeholder:"Enter value under 100",onWheel:n=>n.target.blur(),component:j})})]}),e.jsx(b,{children:e.jsx(o,{label:"Department Select",invalid:!!(r.department&&d.department),errorMessage:r.department,children:e.jsx(g,{name:"department",children:({field:n,form:v})=>e.jsx(ne,{isMulti:!0,componentAs:be,field:n,form:v,options:L,value:a.department,onChange:l=>{v.setFieldValue(n.name,l)}})})})}),e.jsx(ge,{name:"objectives",children:({form:n,remove:v,push:l})=>e.jsx("div",{className:"grid gap-4",children:m&&m.length>0?m.map((M,i)=>{const u=k(n,`objectives[${i}].obj_title`),$=k(n,`objectives[${i}].obj_weight`),F=k(n,`objectives[${i}].Initiative`),T=k(n,`objectives[${i}].kpi`),D=k(n,`objectives[${i}].target`),A=k(n,`objectives[${i}].Responsible`);return e.jsxs(ue,{children:[e.jsxs(b,{className:"grid  md:grid-cols-2 gap-4",children:[e.jsx(o,{label:"Object Title",invalid:u.invalid,errorMessage:u.errorMessage,children:e.jsx(g,{invalid:u.invalid,placeholder:"Object Title",name:`objectives[${i}].obj_title`,type:"text",component:j})}),e.jsx(o,{label:"Object Weight",invalid:$.invalid,errorMessage:$.errorMessage,children:e.jsx(g,{invalid:$.invalid,placeholder:"Weight",name:`objectives[${i}].obj_weight`,type:"number",onWheel:E=>E.target.blur(),component:j})})]}),e.jsxs(b,{className:"grid  md:grid-cols-2 gap-4",children:[e.jsx(o,{label:"Initative",invalid:F.invalid,errorMessage:F.errorMessage,children:e.jsx(g,{invalid:F.invalid,placeholder:"Initative",name:`objectives[${i}].Initiative`,type:"text",component:j})}),e.jsx(o,{label:"KPI",invalid:T.invalid,errorMessage:T.errorMessage,children:e.jsx(g,{invalid:T.invalid,placeholder:"KPI",name:`objectives[${i}].kpi`,type:"text",component:j})})]}),e.jsxs(b,{className:"grid  md:grid-cols-2 gap-4",children:[e.jsx(o,{label:"Target",invalid:D.invalid,errorMessage:D.errorMessage,children:e.jsx(g,{invalid:D.invalid,placeholder:"Target",name:`objectives[${i}].target`,type:"number",onWheel:E=>E.target.blur(),component:j})}),e.jsx(o,{label:"Responsible",invalid:A.invalid,errorMessage:A.errorMessage,children:e.jsx(g,{invalid:A.invalid,placeholder:"Responsible",name:`objectives[${i}].Responsible`,type:"text",component:j})})]}),e.jsxs(b,{className:"flex justify-end gap-4",children:[e.jsx(o,{children:e.jsx(I,{className:"mr-2 mb-2",variant:"twoTone",color:"red-600",type:"button",onClick:()=>{m.length===1?(v(i),l(x)):v(i)},children:"Delete"})}),i===m.length-1&&e.jsx(o,{children:e.jsx(I,{variant:"solid",color:"green-600",type:"button",onClick:()=>{l(x)},children:"Add Objective"})})]})]},i)}):null})}),e.jsx(b,{className:"flex justify-end mt-4",children:e.jsx(o,{children:e.jsx(I,{variant:"solid",type:"submit",loading:t,children:"Submit"})})})]})}}),s===ie&&e.jsx(ee,{enableReinitialize:!0,initialValues:f,validationSchema:De,onSubmit:async(a,{setSubmitting:d})=>{const r={kra_id:h||"",kra_title:a.kra_title,kra_weight:a.kra_weight},t=await Q(r);V((t==null?void 0:t.status)||X,(t==null?void 0:t.message)||z),(t==null?void 0:t.status)==="success"&&R(le),setTimeout(()=>{d(!1)},400)},children:({values:a,touched:d,errors:r,isSubmitting:t,resetForm:y})=>e.jsxs(te,{className:"mt-4",children:[e.jsx(b,{className:"grid  md:grid-cols-2 gap-4",children:e.jsx(o,{label:"Form Name",children:e.jsx(g,{type:"text",name:"heading",placeholder:"Enter Form name",component:j,values:a.heading,readOnly:!0})})}),e.jsxs(b,{className:"grid  md:grid-cols-2 gap-4",children:[e.jsx(o,{label:"Key Result Areas",invalid:r.kra_title&&d.kra_title,errorMessage:r.kra_title,children:e.jsx(g,{type:"text",autoComplete:"off",name:"kra_title",placeholder:"Enter Key Result Areas Title",component:j})}),e.jsx(o,{label:"Weight for KRA",invalid:r.kra_weight&&d.kra_weight,errorMessage:r.kra_weight,children:e.jsx(g,{type:"number",autoComplete:"off",name:"kra_weight",placeholder:"Enter value under 100",onWheel:m=>m.target.blur(),component:j})})]}),e.jsx(b,{className:"flex justify-end",children:e.jsx(o,{children:e.jsx(I,{variant:"solid",type:"submit",loading:t,children:"Submit"})})})]})}),s===re&&e.jsx(ee,{enableReinitialize:!0,initialValues:f,onSubmit:async(a,{setSubmitting:d})=>{const r=O[0].departments,t=a.department,y=r.filter(M=>t.findIndex(i=>i.departmentId===M.department_id)===-1),m=t.filter(M=>r.findIndex(i=>i.department_id===M.departmentId)===-1);let n=!0;if(y.map(async M=>{const i={kra_id:h||"",department:M.department_id},u=await Y(i);if((u==null?void 0:u.status)!=="success"){V((u==null?void 0:u.status)||X,(u==null?void 0:u.message)||z),n=!1;return}}),!n)return;const v={kra_id:String(h),departments:m.map(({departmentId:M})=>M)||[]},l=await U(v);(l==null?void 0:l.status)==="success"?(V("success","MPMS KRA Create successfully"),R(le)):V((l==null?void 0:l.status)||X,(l==null?void 0:l.message)||z),setTimeout(()=>{d(!1)},400)},children:({values:a,touched:d,errors:r,isSubmitting:t,resetForm:y})=>e.jsxs(te,{className:"mt-4",children:[e.jsx(b,{children:e.jsx(o,{label:"Department Select",invalid:!!(r.department&&d.department),errorMessage:r.department,children:e.jsx(g,{name:"department",children:({field:m,form:n})=>e.jsx(ne,{isMulti:!0,componentAs:be,field:m,form:n,options:L,value:a.department,onChange:v=>{n.setFieldValue(m.name,v)}})})})}),e.jsx(b,{className:"flex justify-end",children:e.jsx(o,{children:e.jsx(I,{variant:"solid",type:"submit",loading:t,children:"Submit"})})})]})}),s===se&&e.jsx(ee,{enableReinitialize:!0,initialValues:f,validationSchema:Ae,onSubmit:async(a,{setSubmitting:d})=>{const r={kra_id:String(h),mpms_id:String(O[0].mpms_id),objective:a.objectives},t=await K(r);V((t==null?void 0:t.status)||X,(t==null?void 0:t.message)||z),(t==null?void 0:t.status)==="success"&&R(le),setTimeout(()=>{d(!1)},400)},children:({values:a,touched:d,errors:r,isSubmitting:t,resetForm:y})=>{const m=a.objectives;return e.jsxs(te,{className:"mt-4",children:[e.jsx(ge,{name:"objectives",children:({form:n,remove:v,push:l})=>e.jsx("div",{className:"grid gap-4",children:m&&m.length>0?m.map((M,i)=>{const u=k(n,`objectives[${i}].obj_title`),$=k(n,`objectives[${i}].obj_weight`),F=k(n,`objectives[${i}].Initiative`),T=k(n,`objectives[${i}].kpi`),D=k(n,`objectives[${i}].target`),A=k(n,`objectives[${i}].Responsible`);return e.jsxs(ue,{children:[e.jsxs(b,{className:"grid  md:grid-cols-2 gap-4",children:[e.jsx(o,{label:"Object Title",invalid:u.invalid,errorMessage:u.errorMessage,children:e.jsx(g,{invalid:u.invalid,placeholder:"Object Title",name:`objectives[${i}].obj_title`,type:"text",component:j})}),e.jsx(o,{label:"Object Weight",invalid:$.invalid,errorMessage:$.errorMessage,children:e.jsx(g,{invalid:$.invalid,placeholder:"Weight",name:`objectives[${i}].obj_weight`,type:"number",onWheel:E=>E.target.blur(),component:j})})]}),e.jsxs(b,{className:"grid  md:grid-cols-2 gap-4",children:[e.jsx(o,{label:"Initative",invalid:F.invalid,errorMessage:F.errorMessage,children:e.jsx(g,{invalid:F.invalid,placeholder:"Initative",name:`objectives[${i}].Initiative`,type:"text",component:j})}),e.jsx(o,{label:"KPI",invalid:T.invalid,errorMessage:T.errorMessage,children:e.jsx(g,{invalid:T.invalid,placeholder:"KPI",name:`objectives[${i}].kpi`,type:"text",component:j})})]}),e.jsxs(b,{className:"grid  md:grid-cols-2 gap-4",children:[e.jsx(o,{label:"Target",invalid:D.invalid,errorMessage:D.errorMessage,children:e.jsx(g,{invalid:D.invalid,placeholder:"Target",name:`objectives[${i}].target`,type:"number",onWheel:E=>E.target.blur(),component:j})}),e.jsx(o,{label:"Responsible",invalid:A.invalid,errorMessage:A.errorMessage,children:e.jsx(g,{invalid:A.invalid,placeholder:"Responsible",name:`objectives[${i}].Responsible`,type:"text",component:j})})]}),e.jsxs(b,{className:"flex justify-end gap-4",children:[e.jsx(o,{children:e.jsx(I,{className:"mr-2 mb-2",variant:"twoTone",color:"red-600",type:"button",onClick:()=>{m.length===1?(v(i),l(x)):v(i)},children:"Delete"})}),i===m.length-1&&e.jsx(o,{children:e.jsx(I,{variant:"solid",color:"green-600",type:"button",onClick:()=>{l(x)},children:"Add Objective"})})]})]},i)}):null})}),e.jsx(b,{className:"flex justify-end mt-4",children:e.jsx(o,{children:e.jsx(I,{variant:"solid",type:"submit",loading:t,children:"Submit"})})})]})}})]})};export{ze as default};
